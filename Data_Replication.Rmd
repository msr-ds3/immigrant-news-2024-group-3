---
title: "Data Replication Project"
author: "Salma Ghazi, Shana Mandelbaum"
date: "2024-06-24"
output: 
  html_document:
    toc: yes
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(ggplot2)
library(tidyverse)
library(stargazer)
library(stm)

theme_set(theme_bw())
```

# Description
Replicated figure 4, table 3, figures 2 and 3, and table 4 from https://static1.squarespace.com/static/5ac4569925bf02b3f05a651f/t/638b509cb141756009541e29/1670074524751/Immigration_Paper_V2-1.pdf using only google trends data (without the bing portion)

# Replication
This paper studies the effect that the media has on people looking for ways to report immigrants (through their internet searches) 

## Download Google Trends Data + Format

```{r}
reporting_data <- read_csv("data/Google_Trends_Immigrant_Reporting.csv") 
crime_data <- read_csv("data/Google_Trends_Immigrant_Crime.csv") 
welfare_data <- read_csv("data/Google_Trends_Immigrant_Welfare.csv") 


reporting_data <- 
  reporting_data %>% 
  rename(search_interest = Num_Searches) %>%
  mutate(date=parse_date(Month, "%Y-%m")) %>%
  filter(year(date) < 2020)


crime_data <- 
  crime_data %>% 
  rename(search_interest = Num_Searches) %>%
  mutate(date=parse_date(Month, "%Y-%m")) %>%
  filter(year(date) < 2020) %>%
  filter(search_interest != 0)


welfare_data <- 
  welfare_data %>% 
  rename(search_interest = Num_Searches) %>%
  mutate(date=parse_date(Month, "%Y-%m")) %>%
  filter(year(date) < 2020) %>%
  filter(search_interest != 0)

```


```{r}
reporting_data <- 
  reporting_data %>%
  mutate(President = ifelse(year(date) < 2009, "Bush", ifelse(year(date) < 2017, "Obama", "Trump")))

crime_data <- 
  crime_data %>%
  mutate(President = ifelse(year(date) < 2009, "Bush", ifelse(year(date) < 2017, "Obama", "Trump")))

welfare_data <- 
  welfare_data %>%
  mutate(President = ifelse(year(date) < 2009, "Bush", ifelse(year(date) < 2017, "Obama", "Trump")))
```


## Figure 4
Figure 4 in the paper shows the search interest generated on Google trends about immigration reporting, as well as people searching about immigration in relation to welfare and crime. 
We see that during the Trump presidency, these numbers were usually higher than during the Bush and Obama administrations. 
The paper goes on to analyze media interest before and during the Trump administration to see if a correlation exists between higher reporting searches and media cues.

```{r}
reporting_data %>%
  ggplot(aes(x = date, y = search_interest, color = President)) +
  geom_point() +
  geom_smooth(method = "lm", se = F) +
  labs(x = "Date", y = "Reporting Search Interest")

crime_data %>%
  ggplot(aes(x = date, y = search_interest, color = President)) +
  geom_point() +
  geom_smooth(method = "lm", se = F) +
  labs(x = "Date", y = "Crime Search Interest")


welfare_data %>%
  ggplot(aes(x = date, y = search_interest, color = President)) +
  geom_point() +
  geom_smooth(method = "lm", se=F) +
  labs(x = "Date", y = "Welfare Search Interest")
  

```

## Table 3 
Table 3 is a regression that seeks to see the effects of the date and presidential administration on reporting, crime, and welfare search interest. The results we obtain show that Trump's presidency produced significant effects on search interest. 

```{r}
reporting_data <- 
  reporting_data %>%
  mutate(Is_Bush = (President=="Bush"), Is_Obama = (President=="Obama"), Is_Trump = (President=="Trump"))

crime_data <- 
  crime_data %>%
  mutate(Is_Bush = (President=="Bush"), Is_Obama = (President=="Obama"), Is_Trump = (President=="Trump"))

welfare_data <- 
  welfare_data %>%
  mutate(Is_Bush = (President=="Bush"), Is_Obama = (President=="Obama"), Is_Trump = (President=="Trump"))

```

```{r}
reporting_model <- lm(search_interest ~ date + Is_Bush + Is_Trump + Is_Obama , data=reporting_data)
crime_model <- lm(search_interest ~ date + Is_Bush + Is_Trump + Is_Obama , data=crime_data)
welfare_model <- lm(search_interest ~ date + Is_Bush + Is_Trump + Is_Obama , data=welfare_data)

stargazer(crime_model, welfare_model, reporting_model, type = "text",
          column.labels = c("Crime", "Welfare", "Report"))

```

We obtained different results than the paper due to differences in our data downloaded from google trends.
When given the exact data the paper used, we obtained their results

## Figures 2+3
Figure 2 plots the total number of news segments regarding the topic of immigration on three news channels across three time periods - pre campaign, campaign, and post inauguration (Trump).
Figure 3 uses topics one and three from the topic model which focus on crime and topic 13 which focused on welfare to plot the proportion of segments that focused on these specific topics on the same three channels during the same time period.
The media focused more on the topics of immigration post inauguration, evidently because this was a key part of President Trump's policy. We can also see that more conservative media, such as fox news, focused on the topic of immigration more than cnn and msnbc.

```{r}
load("data/topic_model_lite.RData")
```

Topic Model was given to us

```{r}
line_data <- 
  document_topics %>%
  group_by(time) %>%
  summarize(line_date = max(floor_date(ymd(date), "month")))


document_topics %>%
  mutate(month = floor_date(ymd(date), "month")) %>%
  group_by(month, channel, time) %>%
  summarize(num_segments = n()) %>%
  ggplot(aes(x = month, y = num_segments, color = channel)) +
  geom_point() +
  geom_smooth(aes(group = interaction(channel, time)), se = F) + 
  scale_color_manual(values = c("magenta", "red3", "blue")) + 
  geom_vline(data = line_data, aes(xintercept = line_date), linetype = "dashed") +
  labs(x = "Date", y = "Number of News Segments")
  
```
```{r}
#Crime Plot
document_topics %>%
  select(Topic1, Topic3, date, channel, time) %>%
  mutate(month = floor_date(ymd(date), "month")) %>%
  group_by(month, channel, time) %>%
  summarize(crime_prop = sum(Topic1, Topic3)) %>%
  ggplot(aes(x = month, y = crime_prop, color = channel)) +
  geom_point() +
  geom_smooth(aes(group = interaction(channel, time)), se = F) + 
  scale_color_manual(values = c("magenta", "red3", "blue")) + 
  geom_vline(data=line_data, aes(xintercept = line_date), linetype = "dashed") +
  labs(x = "Date", y = "Crime Proportion")


#Welfare Plot
document_topics %>%
  select(Topic13, date, channel, time) %>%
  mutate(month = floor_date(ymd(date), "month")) %>%
  group_by(month, channel, time) %>%
  summarize(welfare_prop = sum(Topic13)) %>%
  ggplot(aes(x = month, y = welfare_prop, color = channel)) +
  geom_point() + 
  geom_smooth(aes(group = interaction(channel, time)), se=F) + 
  scale_color_manual(values = c("magenta", "red3", "blue")) + 
  geom_vline(data = line_data, aes(xintercept = line_date), linetype = "dashed") +
  labs(x = "Date", y = "Welfare Proportion")
  
  
```

## Table 4

In table 4, we run a regression to see if the number of news segments focusing on immigration (as well as the specific border and crime proportions), Trump's presidency and the month have a significant effect on the search interest. We see that Trump's presidency and the number of segments have a significant effect on the reporting search interest.

this model does not include the daily data

```{r}
Segment_Info <- 
  document_topics %>%
  mutate(month = floor_date(ymd(date), "month")) %>%
  group_by(month, channel, time) %>%
  summarize(num_segments = n(), welfare_prop = sum(Topic13), crime_prop = sum(Topic1, Topic3)) %>%
  mutate(month_of_year = month(month)) %>%
  inner_join(reporting_data, join_by(month == date)) 

table_4_model <- lm(search_interest ~ num_segments + welfare_prop + crime_prop + Is_Trump + month + month_of_year, data=Segment_Info)


stargazer(table_4_model, type = "text")
```

Adjusting for the daily data, we obtain the same result that the Trump administration and the number of news segments surrounding the topic of immigration have a significant effect on the reporting search interest. We can now also see that the reporting search interest and the border and crime proportions have a positive correlation.
This model does include the daily data

```{r}
daily_info <- read_csv("data/gt_report_daily.csv")

Segment_Info_Daily <- 
  document_topics %>%
  mutate(Is_Trump = (date >= "2017-01-20")) %>%
  group_by(date, channel, time, Is_Trump) %>%
  mutate(date = as.Date(date, "%Y-%m-%d")) %>%
  summarize(num_segments = n(), welfare_prop = sum(Topic13), crime_prop = sum(Topic1, Topic3)) %>%
  mutate(month_of_year = as.factor(month(date)), day_of_week = as.factor(wday(date))) %>%
  inner_join(daily_info, join_by(date == date)) 

table_4_model_daily <- lm(search_adj ~ num_segments + welfare_prop + crime_prop + Is_Trump + date + month_of_year + day_of_week, data=Segment_Info_Daily)

stargazer(table_4_model_daily, type = "text")
```
# Extension

We are looking at the correlation between media coverage of the Mexican border crisis and migrants being apprehended and expelled at the border during the time period of 2014-2019.

## Download Border Data
```{r}
border_migrant_data <- read_csv("data/border_migrant_data.csv")
```
## Graph Border Apprehensions Over Time

This graph shows the amount of people apprehended at the border during both the Trump and Obama administrations. 
```{r}
border_migrant_data <- border_migrant_data %>%  
  mutate(date = parse_date(Date, "%Y-%m")) %>% 
  mutate(president = ifelse(year(date) < 2017, "Obama", "Trump"))

border_migrant_data %>% 
  ggplot(aes(x = date, y = Number, color = president)) + 
  geom_point() +
  geom_smooth(se = F) + 
  labs(x = "Date", y = "Immigrants at Border")
```

## Media Coverage Graph

We graph the same media coverage graph as before, but looking at Topic 6 as this is the topic that discusses the Mexican border crisis.
We obtain similar results to the above graphs: the border proportion goes up during the Trump administration and fox news discusses it the most.
We can conclude from this that during the Trump administration the number of people being apprehended and expelled at the border increased, as did media coverage of the Mexican border crisis

```{r}
document_topics %>% 
  mutate(month = floor_date(ymd(date), "month")) %>%  
  group_by(time, channel, month) %>% 
  summarise(border_prop = sum(Topic6)) %>% 
  ggplot(aes(x = month, y = border_prop, color = channel)) +
  geom_point() + 
  geom_smooth(aes(group = interaction(channel, time)), se = F) +
  scale_color_manual(values = c("magenta", "red3", "blue")) +
  geom_vline(data = line_data, aes(xintercept = line_date), linetype = "dashed") + 
  labs(x = "Date", y = "Border Proportion")
```

## Graphs Mapped Together
We expected to see an obvious correlation between the number of migrants apprehended at the border and media coverage, but it seems to be the opposite.

```{r}
migrant_plot_data <- border_migrant_data %>% 
  filter(year(date) < 2020)
documents_plot_data <- document_topics %>% 
  filter(channel == "fox") %>% 
  mutate(month = floor_date(ymd(date), "month")) %>% 
  mutate(time = ifelse(date <= "2017-01-01", "pre", "post")) %>% 
  group_by(time, channel, month) %>% 
  summarise(border_prop = sum(Topic6))
 
line_plot_data <- line_data %>% 
  filter(line_date == "2017-01-01")
 
ggplot() +
  geom_point(data = migrant_plot_data, aes(x = date, y = Number, color = president)) +
  geom_smooth(data = migrant_plot_data, aes(x = date, y = Number, color = president), 
              se = FALSE) +
  scale_y_continuous(name = "Number", limits = c(0, 150000)) +
  geom_point(data = documents_plot_data,  aes(x = month, y = border_prop * 1500, group = time), 
             color = "blue") +
  geom_smooth(data = documents_plot_data, aes(x = month, y = border_prop * 1500, group = time), 
              se = FALSE, inherit.aes = FALSE) +
  geom_vline(data = line_plot_data, aes(xintercept = line_date), linetype = "dashed") +
  scale_y_continuous(
    name = "Immigrants at Border",
    limits = c(0, 150000),
    sec.axis = sec_axis(~./1500, name = "Border Proportion (Fox News)")
  ) +
  theme_minimal() + 
  theme(
    axis.title.y.right = element_text(color = "blue"),
    axis.text.y.right = element_text(color = "blue"),
    axis.ticks.y.right = element_line(color = "blue"))
```


## Regression

We did a regression to see if the proportion of times the border crisis was mentioned on the number of immigrants being apprehended on the border and the presidential administration.
Although we expected the number of immigrants apprehended at the border to have a larger effect than it did on the proportion of times the media discussed immigration at the border, this was not present in our regression.
However, we see that the Trump administration has a significant effect, and the number of people apprehended at the border and the border proportion does seem to have a positive correlation.

```{r}
migrant_model_info <- document_topics %>% 
  mutate(Is_Trump = (date >= "2017-01-20")) %>% 
  group_by(channel, date, Is_Trump) %>% 
  mutate(date = as.Date(date, "%Y-%m-%d")) %>%  
  summarise(num_segs = n(), border_prop = sum(Topic6)) %>%  
  mutate(month_of_year = as.factor(month(date))) %>% 
  inner_join(border_migrant_data, join_by(date == date))
 
migrant_model <- lm(border_prop ~ Is_Trump + Number, data = migrant_model_info)
stargazer(migrant_model, type = "text", digits = 8)
```


